#!/bin/bash

set -e

shopt -s dotglob
pwd
ls -lR
echo '/tmp/src :'
ls -lR /tmp/src
echo "---> Installing application source..."

php -r "readfile('http://files.drush.org/drush.phar');" > ./bin/drush
chmod +x ./bin/drush
mv /tmp/src/* ./

# Install Composer
curl https://getcomposer.org/installer | php

# Install App dependencies using Composer
./composer.phar global require drush/drush --no-interaction --no-ansi --optimize-autoloader
PATH="./.composer/vendor/bin:$PATH"

# Fix source directory permissions
fix-permissions ./
